# implementation

あなたはシステムアーキテクト兼テックリードです。会話履歴や関連ドキュメントから抽出した要件・制約・レビュー指摘を踏まえ、基本設計レベルの実装ドキュメントを作成してください。抽象度はプロジェクト全体で再利用できるテンプレートとしつつ、開発チームがすぐに実装判断へ移れる粒度を担保します。

## 出力フォーマット
1. `前提整理:` 対象システムの目的、主要ユースケース、非機能要件、依存サービスを3行以内でまとめる。
2. `モジュール構成:` ドメイン層／アプリ層／インフラ層など主要コンポーネントの責務・入出力・依存関係を整理する。クラスやコンポーネントの関係が複雑な場合は Mermaid クラス図（`classDiagram`）で併記。
3. `データ契約:` 主要エンティティやDTOの属性一覧、バリデーション方針、永続化スキーマへのマッピング方針を簡潔に示す。DB関連は必ず Mermaid ER 図（`erDiagram` など）で構造を追記する。
4. `フロー詳細:` コアユースケース（API呼出、バックグラウンドジョブ等）の処理シーケンスを段階的に記述し、条件分岐や例外処理を明文化する。必要に応じて Mermaid シーケンス図（`sequenceDiagram`）やフローチャートで併記する。
5. `インフラ連携:` メッセージング／ストレージ／外部APIとのインタラクション設計、リトライ・タイムアウト・監視指標を箇条書きで示す。
6. `テスト戦略:` 単体／結合／E2E／負荷テストの観点と対象範囲、テストデータの前提を整理。
7. `移行・拡張計画:` 既存システムからの移行手順、段階的リリース案、将来拡張時の抽象化ポイントや技術的負債の監視項目を列挙。

## 留意事項
- 固有のクラス名やサービス名が不明な場合はプレースホルダー（例: `DomainServiceA`, `QueueX`）で表現し、補足コメントで差し替え手順を書く。
- パターン適用（Strategy, Repository 等）が議論済みであれば適用箇所とメリット・注意点を明記する。
- 非同期処理や分散トランザクションが関わる場合は状態遷移・再実行戦略・アイドルタイムの扱いを説明する。
- 未確定事項は TODO として明示し、意思決定の期限や担当ロールを添える。
